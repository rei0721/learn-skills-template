---
name: 项目地图
description: Go Scaffold 项目的整体结构、模块划分和依赖关系
category: 核心
priority: 1
dependencies: []
---

# 项目地图

## 职责范围

- 定义项目的整体结构和模块划分
- 明确模块间的依赖方向和禁止反向依赖
- 标注高风险区域和关键流转路径
- 作为所有技能书的入口和索引

## 适用场景

- **始终加载**: 任何任务开始前必须先读取
- 新增功能时确认模块归属
- 修改代码时确认依赖方向
- 重构时确认影响范围

## 核心规则

### 1. 模块分层

```
cmd/          → 应用程序入口层
    ↓
internal/     → 业务逻辑层（不对外暴露）
    ↓
pkg/          → 公共组件层（可复用）
    ↓
types/        → 类型定义层（最底层）
```

### 2. 依赖方向

- **严格单向**: 上层可以依赖下层，下层不能依赖上层
- **禁止跨层**: 不允许跨层依赖（如 cmd 直接依赖 pkg 的具体实现）
- **接口隔离**: 层与层之间通过接口通信

### 3. 模块职责

#### cmd/ - 应用入口层
- **职责**: 命令行接口、参数解析、应用启动
- **禁止**: 包含业务逻辑、直接操作数据库
- **依赖**: internal/app

#### internal/ - 业务逻辑层
- **app/**: 依赖注入容器，组件生命周期管理
- **config/**: 配置管理，环境变量处理
- **handler/**: HTTP 请求处理，参数验证
- **middleware/**: 请求预处理，认证授权
- **models/**: 数据模型，ORM 映射
- **repository/**: 数据访问抽象
- **router/**: 路由配置
- **service/**: 业务逻辑实现

#### pkg/ - 公共组件层
- **cache/**: 缓存抽象（Redis）
- **database/**: 数据库抽象（MySQL/PostgreSQL/SQLite）
- **logger/**: 日志系统（Zap）
- **jwt/**: JWT 认证
- **rbac/**: 权限控制（Casbin）
- **executor/**: 协程池管理
- **其他**: crypto, i18n, httpserver, dbtx, sqlgen, utils, yaml2go

#### types/ - 类型定义层
- **constants/**: 常量定义
- **errors/**: 错误码和错误类型
- **result/**: 统一响应格式
- **interfaces.go**: 公共接口

## AI 行为约束

### 必须遵守

1. **读取优先**: 任何任务开始前必须先读取本技能书
2. **依赖检查**: 修改代码前必须确认依赖方向
3. **职责确认**: 新增功能前必须确认模块归属
4. **影响评估**: 重构前必须评估影响范围

### 禁止行为

1. **反向依赖**: 禁止下层依赖上层
2. **跨层依赖**: 禁止跨层直接依赖
3. **职责混乱**: 禁止在错误的层实现功能
4. **绕过接口**: 禁止绕过接口直接依赖实现

### 违规处理

- 检测到反向依赖 → **直接拒绝执行**
- 检测到跨层依赖 → **直接拒绝执行**
- 检测到职责混乱 → **中断并要求确认**

## 更新规则

### 必须更新的情况

1. 新增模块或包
2. 删除模块或包
3. 模块职责变化
4. 依赖关系变化

### 更新流程

1. 更新 `module-index.md`（模块索引）
2. 更新 `risk-zones.md`（高风险区域）
3. 通知相关技能书同步更新
4. 更新本文件的修改日期

---

**最后更新**: 2026-01-19
**维护者**: AI Assistant
