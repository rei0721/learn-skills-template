---
name: 文档维护规范
description: docs 项目文档的更新、维护和同步规则
category: 核心
priority: 5
dependencies: [00-project-map, 01-project-foundation]
---

# 文档维护规范

## 职责范围

- 定义 docs 文档的更新触发条件
- 规范文档的组织结构和命名
- 明确文档与代码的同步规则
- 定义文档质量标准

## 适用场景

- 新增功能或模块
- 修改现有功能
- 重构代码
- 修复 Bug
- 更新配置
- 变更架构

## 核心规则

### 1. 文档结构

#### 当前文档组织

```
docs/
├── README.md                      # 文档入口和导航
├── DOCUMENTATION_SUMMARY.md       # 文档总览
├── changelog.md                   # 变更日志
├── faq.md                         # 常见问题
│
├── overview/                      # 项目概览
│   ├── introduction.md           # 项目介绍
│   ├── architecture.md           # 架构设计
│   └── tech-stack.md             # 技术栈
│
├── getting-started/               # 快速开始
│   ├── prerequisites.md          # 前置要求
│   ├── installation.md           # 安装指南
│   └── quickstart.md             # 快速开始
│
├── development/                   # 开发指南
│   ├── project-structure.md     # 项目结构
│   └── configuration.md          # 配置管理
│
└── contributing/                  # 贡献指南
    ├── contributing.md           # 贡献指南
    └── code-style.md             # 代码风格
```

### 2. 文档更新触发条件

#### 🔴 必须立即更新（P0）

| 触发条件                     | 必须更新的文档                                    | 说明                           |
| ---------------------------- | ------------------------------------------------- | ------------------------------ |
| 新增模块或包                 | `project-structure.md`, `architecture.md`         | 更新项目结构和架构图           |
| 删除模块或包                 | `project-structure.md`, `architecture.md`         | 移除相关说明                   |
| 修改配置文件结构             | `configuration.md`                                | 更新配置说明和示例             |
| 新增配置项                   | `configuration.md`                                | 添加配置项说明                 |
| 修改 API 接口                | 创建或更新 `api/` 目录下的文档                    | 更新 API 文档                  |
| 修改数据库表结构             | 创建或更新 `development/database.md`              | 更新数据库设计文档             |
| 修改依赖关系                 | `architecture.md`, `tech-stack.md`                | 更新依赖关系图和技术栈         |
| 修改启动流程                 | `quickstart.md`, `installation.md`                | 更新启动步骤                   |
| 修改环境要求                 | `prerequisites.md`                                | 更新环境要求                   |

#### 🟠 应该尽快更新（P1）

| 触发条件                     | 应该更新的文档                                    | 说明                           |
| ---------------------------- | ------------------------------------------------- | ------------------------------ |
| 新增功能                     | `changelog.md`, 相关功能文档                      | 记录变更，添加功能说明         |
| 修改现有功能                 | `changelog.md`, 相关功能文档                      | 记录变更，更新功能说明         |
| 性能优化                     | `changelog.md`, `architecture.md`                 | 记录优化内容                   |
| 安全修复                     | `changelog.md`                                    | 记录安全修复                   |
| Bug 修复                     | `changelog.md`, `faq.md`（如果是常见问题）       | 记录修复内容                   |

#### 🟡 建议更新（P2）

| 触发条件                     | 建议更新的文档                                    | 说明                           |
| ---------------------------- | ------------------------------------------------- | ------------------------------ |
| 代码重构                     | `architecture.md`, `project-structure.md`         | 如果影响架构或结构             |
| 添加注释                     | 无需更新文档                                      | 代码注释不影响文档             |
| 代码格式化                   | 无需更新文档                                      | 格式化不影响文档               |

### 3. 文档更新规则

#### 规则 1: 代码变更必须同步文档

**强制要求**:
```
代码提交前检查清单：
- [ ] 确认是否触发文档更新条件
- [ ] 更新相关文档
- [ ] 验证文档内容准确性
- [ ] 更新 changelog.md（如果是功能变更）
```

**违规处理**: **直接拒绝提交**

#### 规则 2: 文档必须与代码一致

**检查方式**:
- 配置示例必须与 `configs/config.yaml` 一致
- 项目结构必须与实际目录结构一致
- API 文档必须与实际接口一致
- 架构图必须与实际架构一致

**违规处理**: **中断并要求修正**

#### 规则 3: 文档必须包含示例

**要求**:
- 配置说明必须包含示例
- API 文档必须包含请求/响应示例
- 功能说明必须包含使用示例
- 错误处理必须包含错误码示例

**违规处理**: **警告并建议补充**

#### 规则 4: 文档必须保持最新

**检查方式**:
- 每次发版前检查文档是否最新
- 定期审查文档与代码的一致性
- 使用自动化工具检查（如果可能）

**违规处理**: **阻止发版**

### 4. 具体更新场景

#### 场景 1: 新增模块

**触发**: 在 `internal/` 或 `pkg/` 下新增目录

**必须更新**:
1. `docs/development/project-structure.md`
   ```markdown
   ## 新增模块说明
   
   ### internal/newmodule/ - 新模块
   
   **职责**:
   - 功能描述
   
   **依赖**:
   - 依赖的其他模块
   ```

2. `docs/overview/architecture.md`
   ```markdown
   ## 模块依赖图
   
   [更新 mermaid 图，添加新模块]
   ```

3. `docs/changelog.md`
   ```markdown
   ## [版本号] - YYYY-MM-DD
   
   ### Added
   - 新增 xxx 模块，用于 xxx 功能
   ```

#### 场景 2: 修改配置

**触发**: 修改 `configs/config.yaml` 或 `internal/config/`

**必须更新**:
1. `docs/development/configuration.md`
   ```markdown
   ## 配置项说明
   
   ### 新配置项
   
   **配置路径**: `section.new_config`
   **类型**: string
   **默认值**: "default"
   **说明**: 配置项说明
   **示例**:
   ```yaml
   section:
     new_config: "value"
   ```
   ```

2. `docs/changelog.md`
   ```markdown
   ### Changed
   - 修改 xxx 配置项，新增 yyy 选项
   ```

#### 场景 3: 新增 API

**触发**: 在 `internal/handler/` 或 `internal/router/` 中新增接口

**必须更新**:
1. 创建或更新 `docs/api/` 目录（如果不存在则创建）
   ```markdown
   # API 文档
   
   ## 新增接口
   
   ### POST /api/v1/xxx
   
   **描述**: 接口描述
   
   **请求参数**:
   ```json
   {
     "field": "value"
   }
   ```
   
   **响应示例**:
   ```json
   {
     "code": 0,
     "message": "success",
     "data": {}
   }
   ```
   
   **错误码**:
   - 400: 参数错误
   - 401: 未授权
   ```

2. `docs/changelog.md`
   ```markdown
   ### Added
   - 新增 POST /api/v1/xxx 接口
   ```

#### 场景 4: 修改数据库表

**触发**: 修改 `internal/models/`

**必须更新**:
1. 创建或更新 `docs/development/database.md`
   ```markdown
   # 数据库设计
   
   ## 表结构
   
   ### users 表
   
   | 字段名    | 类型         | 说明     | 约束              |
   | --------- | ------------ | -------- | ----------------- |
   | id        | bigint       | 主键     | PRIMARY KEY       |
   | username  | varchar(50)  | 用户名   | UNIQUE, NOT NULL  |
   | created_at| timestamp    | 创建时间 | NOT NULL          |
   ```

2. `docs/changelog.md`
   ```markdown
   ### Changed
   - 修改 users 表结构，新增 xxx 字段
   ```

#### 场景 5: 修改依赖

**触发**: 修改 `go.mod`

**必须更新**:
1. `docs/overview/tech-stack.md`
   ```markdown
   ## 核心依赖
   
   | 依赖                | 版本   | 用途           |
   | ------------------- | ------ | -------------- |
   | github.com/xxx/yyy  | v1.2.3 | 依赖说明       |
   ```

2. `docs/getting-started/prerequisites.md`（如果影响环境要求）
   ```markdown
   ## 依赖要求
   
   - 新增依赖说明
   ```

3. `docs/changelog.md`
   ```markdown
   ### Changed
   - 升级 xxx 依赖到 v1.2.3
   ```

#### 场景 6: 重构架构

**触发**: 修改分层结构或依赖关系

**必须更新**:
1. `docs/overview/architecture.md`
   ```markdown
   ## 架构变更说明
   
   [更新架构图和说明]
   ```

2. `docs/development/project-structure.md`
   ```markdown
   ## 依赖方向变更
   
   [更新依赖关系说明]
   ```

3. `docs/changelog.md`
   ```markdown
   ### Changed
   - 重构 xxx 模块，优化依赖关系
   ```

### 5. 文档质量标准

#### 内容标准

- ✅ 准确性: 文档内容与代码实现一致
- ✅ 完整性: 覆盖所有重要功能和配置
- ✅ 清晰性: 语言简洁明了，易于理解
- ✅ 示例性: 包含足够的示例代码
- ✅ 时效性: 保持最新，及时更新

#### 格式标准

- ✅ 使用 Markdown 格式
- ✅ 使用标准的标题层级（# ## ### ####）
- ✅ 代码块使用语法高亮（```go, ```yaml, ```json）
- ✅ 表格格式规范
- ✅ 链接有效且正确

#### 结构标准

- ✅ 每个文档有清晰的标题
- ✅ 使用目录（如果文档较长）
- ✅ 逻辑结构清晰
- ✅ 相关文档之间有链接

### 6. 文档维护检查清单

#### 代码提交前检查

```markdown
## 文档更新检查清单

### 代码变更
- [ ] 确认代码变更类型（新增/修改/删除）
- [ ] 确认是否触发文档更新（参考触发条件表）
- [ ] 确认需要更新的文档列表

### 文档更新
- [ ] 更新相关文档内容
- [ ] 验证文档内容准确性
- [ ] 检查示例代码可运行
- [ ] 更新 changelog.md（如果需要）
- [ ] 检查文档格式规范

### 质量检查
- [ ] 文档内容与代码一致
- [ ] 包含必要的示例
- [ ] 链接有效
- [ ] 格式规范
- [ ] 语言清晰

### 最终确认
- [ ] 所有相关文档已更新
- [ ] 文档质量达标
- [ ] 可以提交代码
```

#### 发版前检查

```markdown
## 发版文档检查清单

### 版本信息
- [ ] 更新版本号（README.md, changelog.md）
- [ ] 更新发版日期

### 文档完整性
- [ ] 所有新功能都有文档
- [ ] 所有配置变更都有说明
- [ ] 所有 API 变更都有文档
- [ ] changelog.md 完整记录所有变更

### 文档准确性
- [ ] 配置示例与实际一致
- [ ] API 文档与实际一致
- [ ] 架构图与实际一致
- [ ] 项目结构与实际一致

### 文档质量
- [ ] 所有文档格式规范
- [ ] 所有链接有效
- [ ] 所有示例可运行
- [ ] 语言清晰易懂

### 最终确认
- [ ] 文档审查通过
- [ ] 可以发版
```

### 7. 自动化检查（建议）

#### 配置一致性检查

```bash
# 检查配置文档与实际配置文件是否一致
# 可以编写脚本自动检查
./scripts/check-config-docs.sh
```

#### 链接有效性检查

```bash
# 检查文档中的链接是否有效
# 可以使用工具如 markdown-link-check
npx markdown-link-check docs/**/*.md
```

#### 格式规范检查

```bash
# 检查 Markdown 格式是否规范
# 可以使用工具如 markdownlint
npx markdownlint docs/**/*.md
```

## AI 行为约束

### 必须遵守

1. **同步更新**: 代码变更必须同步更新文档
2. **触发检查**: 每次代码变更前检查是否触发文档更新
3. **质量保证**: 确保文档内容准确、完整、清晰
4. **格式规范**: 遵守文档格式标准

### 禁止行为

1. **跳过更新**: 禁止跳过必须更新的文档
2. **不一致**: 禁止文档与代码不一致
3. **缺少示例**: 禁止文档缺少必要的示例
4. **格式混乱**: 禁止文档格式不规范

### 违规处理

- 检测到跳过必须更新的文档 → **直接拒绝执行**
- 检测到文档与代码不一致 → **中断并要求修正**
- 检测到缺少示例 → **警告并建议补充**
- 检测到格式不规范 → **警告并建议修正**

### 执行流程

```
代码变更
    ↓
检查是否触发文档更新
    ↓
是 → 确定需要更新的文档列表
    ↓
    更新文档内容
    ↓
    验证文档质量
    ↓
    提交代码和文档
    ↓
否 → 直接提交代码
```

## 更新规则

### 必须更新的情况

1. 新增文档更新触发条件
2. 修改文档结构
3. 新增文档质量标准
4. 修改文档格式规范

### 更新流程

1. 更新本技能书
2. 通知相关技能书同步更新
3. 更新 `docs/README.md`（如果需要）
4. 更新本文件的修改日期

---

**最后更新**: 2026-01-19
**维护者**: AI Assistant
